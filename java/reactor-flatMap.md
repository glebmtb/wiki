Основные различия между тремя операторами сводятся к **параллелизму** и **гарантиям порядка**:

---

### 1. `flatMap`

* **Параллелизм:** максимально свободный — запускает все внутренние `Publisher`-ы сразу (до `maxConcurrency` по умолчанию бесконечно), как только они готовы, сразу эмитит результат.
* **Порядок:** **не гарантируется** — элементы выходного потока могут «перескакивать» в зависимости от скорости работы каждого вложенного `Mono`/`Flux`.
* **Когда применять:**

    * Когда важна скорость/пропускная способность и вы не привязаны к порядку.
    * Когда у вас нет зависимости между элементами.

```java
Flux.fromIterable(cartPromos)
    .flatMap(cartPromo -> doAsync(cartPromo))  // быстрые и медленные смешаются
    .collectList();
```

---

### 2. `concatMap`

* **Параллелизм:** **нулевой** — обрабатывает элементы строго по одному, не переходя к следующему, пока не завершится текущий внутренний поток.
* **Порядок:** **жёстко сохраняется** — выходной поток точно повторит порядок исходного.
* **Когда применять:**

    * Когда нужно стопроцентное соответствие порядку источника.
    * Когда важно, чтобы следующий элемент начал обработку только после полного окончания предыдущего.

```java
Flux.fromIterable(cartPromos)
    .concatMap(cartPromo -> doAsync(cartPromo))  // один за другим
    .collectList();
```

---

### 3. `flatMapSequential`

* **Параллелизм:** поддерживает **ограниченный** параллелизм: вы можете задать `maxConcurrency`.
* **Порядок:** **сохраняется** при эмиссии результатов — даже если внутренние `Publisher`-ы отработали в разном темпе, их выход будет упорядочен так же, как пришёл вход.
* **Когда применять:**

    * Когда нужен компромисс: скорость (несколько подпотоков) + гарантированный порядок.

```java
Flux.fromIterable(cartPromos)
    .flatMapSequential(
        cartPromo -> doAsync(cartPromo),
        4              // одновременно обрабатывать до 4 элементов
    )
    .collectList();
```

---

| Оператор            | Гарантия порядка | Параллелизм                  |
| ------------------- | ---------------- | ---------------------------- |
| `flatMap`           | нет              | неограниченный (по умолч.)   |
| `concatMap`         | да               | строго последовательный      |
| `flatMapSequential` | да               | ограниченный (настраиваемый) |

---

**Выбор зависит от ваших требований:**

* **Если порядок не важен,** и вы хотите максимум скорости — используйте `flatMap`.
* **Если нужен стопроцентный порядок,** но порядок важнее скорости — `concatMap`.
* **Если нужен порядок плюс небольшой параллелизм,** берите `flatMapSequential`.
